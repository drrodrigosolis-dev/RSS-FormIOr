<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="generator" content="litedown 0.9">
<title></title>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  print-color-adjust: exact;
  -webkit-print-color-adjust: exact;
}
body, .abstract, code, .footnotes, footer, #refs, .caption { font-size: .9em; }
li li { font-size: .95em; }
ul:has(li > input[type="checkbox"]) { list-style: none; padding-left: 1em; }
*, :before, :after { box-sizing: border-box; }
a { color: steelblue; }
pre, img { max-width: 100%; }
pre { white-space: pre-wrap; word-break: break-word; }
pre code { display: block; padding: 1em; overflow-x: auto; }
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre, th) > code, code[class], div > .caption { background: #f8f8f8; }
pre > code:is(:not([class]), .language-plain, .language-none, .plain), .box, .figure, .table { background: inherit; border: 1px solid #eee; }
pre > code {
  &.message { border-color: #9eeaf9; }
  &.warning { background: #fff3cd; border-color: #fff3cd; }
  &.error { background: #f8d7da; border-color: #f8d7da; }
}
.fenced-chunk { border-left: 1px solid #666; }
.code-fence {
  opacity: .4;
  border: 1px dashed #666;
  border-left: 2px solid;
  &:hover { opacity: inherit; }
}
.box, .figure, .table, table { margin: 1em auto; }
div > .caption { padding: 1px 1em; }
.figure { p:has(img, svg), pre:has(svg) { text-align: center; } }
.flex-col { display: flex; justify-content: space-between; }
table {
  &:only-child:not(.table > *) { margin: auto; }
  th, td { padding: 5px; font-variant-numeric: tabular-nums; }
  thead, tfoot, tr:nth-child(even) { background: whitesmoke; }
  thead th { border-bottom: 1px solid #ddd; }
  &:not(.datatable-table) {
    border-top: 1px solid #666;
    border-bottom: 1px solid #666;
  }
}
blockquote {
  color: #666;
  margin: 0;
  padding: 1px 1em;
  border-left: .5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC {
  a { text-decoration: none; }
  ul { list-style: none; padding-left: 1em; }
  & > ul { padding: 0; }
  ul ul { border-left: 1px solid lightsteelblue; }
}
.body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.main-number::after { content: "."; }
span[class^="ref-number-"] { font-weight: bold; }
.ref-number-fig::after, .ref-number-tab::after { content: ":"; }
.cross-ref-chp::before { content: "Chapter "; }
.cross-ref-sec::before { content: "Section "; }
.cross-ref-fig::before, .ref-number-fig::before { content: "Figure "; }
.cross-ref-tab::before, .ref-number-tab::before { content: "Table "; }
.cross-ref-eqn::before, .MathJax_ref:has(mjx-mtext > mjx-c + mjx-c)::before { content: "Equation "; }
.abstract, #refs {
  &::before { display: block; margin: 1em auto; font-weight: bold; }
}
.abstract::before { content: "Abstract"; text-align: center; }
#refs::before { content: "Bibliography"; font-size: 1.5em; }
.ref-paren-open::before { content: "("; }
.ref-paren-close::after { content: ")"; }
.ref-semicolon::after { content: "; "; }
.ref-and::after { content: " and "; }
.ref-et-al::after { content: " et al."; font-style: italic; }
.footnote-ref a {
  &::before { content: "["; }
  &::after { content: "]"; }
}
section.footnotes {
  margin-top: 2em;
  &::before { content: ""; display: block; max-width: 20em; }
}
.fade {
  background: repeating-linear-gradient(135deg, white, white 30px, #ddd 32px, #ddd 32px);
  opacity: 0.6;
}

@media print {
  body { max-width: 100%; }
  tr, img { break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  body:not(.pagesjs) pre:has(.line-numbers):not(:hover) { white-space: pre; }
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.14.24/css/prism-xcode.min.css">
</head>
<body>
<div class="frontmatter">
</div>
<div class="body">
<h1 id="chp:reviewduplicatesubmissions">ReviewDuplicateSubmissions</h1>
<p><strong>Title:</strong> Interactively review and resolve duplicate submissions</p>
<h2 id="sec:what-this-function-is-for">What this function is for</h2>
<p>This function helps you manually resolve duplicated submission IDs when you want
full control over which rows to keep. It shows each duplicate group and lets you
pick one or more rows to keep.</p>
<h2 id="sec:overview">Overview</h2>
<p><code>ReviewDuplicateSubmissions()</code> walks you through duplicate groups defined by key
columns (for example <code>email</code>, <code>username</code>, <code>project_id</code>). For each duplicate group,
it prints the columns you choose (so you can compare submissions), then asks which
submissions to keep. You can keep multiple submissions or drop all submissions
for a given group if needed.</p>
<p>If audit logging is active (see <code>StartAuditLog()</code>), each decision is logged.</p>
<h2 id="sec:how-it-fits-into-a-workflow">How it fits into a workflow</h2>
<p>Use this after you have a flattened dataset and want to resolve duplicates
manually. If you want a fully automatic approach, use <code>DeduplicateSubmissions()</code>.</p>
<h2 id="sec:usage">Usage</h2>
<pre><code class="language-r">ReviewDuplicateSubmissions(
  x,
  id_col = 1,
  key_cols = NULL,
  compare_cols = NULL,
  return_flat = FALSE,
  quiet = FALSE,
  keep_map = NULL,
  prompt = TRUE,
  default_keep = &quot;all&quot;
)
</code></pre>
<h2 id="sec:key-inputs">Key inputs</h2>
<ul>
<li><code>x</code>: A data frame of responses, or a list from <code>FlattenSubmissions()</code>.</li>
<li><code>id_col</code>: Integer or character. Submission ID column (default 1).</li>
<li><code>key_cols</code>: Columns used to define duplicates (for example <code>username</code>, <code>email</code>, <code>project_id</code>).
If <code>NULL</code>, you will be prompted to choose columns interactively (unless <code>prompt = FALSE</code>).
The default suggestions are the first three columns that do not start with <code>form-</code> or <code>form_</code>.</li>
<li><code>compare_cols</code>: Optional. Columns to show when comparing duplicates.
If <code>NULL</code>, you will be prompted to choose columns interactively (unless <code>prompt = FALSE</code>).</li>
<li><code>return_flat</code>: Logical. If <code>TRUE</code> and <code>x</code> came from <code>FlattenSubmissions()</code>,
include the updated list as <code>flat</code> in the output.</li>
<li><code>quiet</code>: Logical. If <code>FALSE</code>, prints guidance and summaries.</li>
<li><code>keep_map</code>: Optional. Non-interactive decisions for which submissions to keep,
keyed by duplicate <code>group_id</code> or <code>group_key</code>. Accepts a named list/vector or
a data frame with columns <code>group_id</code>/<code>group_key</code> and <code>keep</code>.
Values can be row numbers, ranges like <code>&quot;1:3&quot;</code>, or keywords <code>&quot;all&quot;</code> / <code>&quot;none&quot;</code>.</li>
<li><code>prompt</code>: Logical. If <code>TRUE</code> (default), ask interactively. If <code>FALSE</code>, uses <code>keep_map</code>
and <code>default_keep</code> without prompting.</li>
<li><code>default_keep</code>: Default action when <code>prompt = FALSE</code> and no <code>keep_map</code> entry exists
for a given ID. Default <code>&quot;all&quot;</code>.</li>
</ul>
<h2 id="sec:outputs">Outputs</h2>
<ul>
<li><code>data</code>: Data frame after duplicate review</li>
<li><code>summary</code>: List with counts and whether the review stopped early</li>
<li><code>decisions</code>: Data frame describing what was kept/dropped for each duplicate group</li>
<li><code>flat</code>: If <code>return_flat = TRUE</code> and <code>x</code> was a FlattenSubmissions list, the updated list</li>
</ul>
<h2 id="sec:details-and-behavior">Details and behavior</h2>
<ul>
<li>The function is interactive by default. For scripts, provide <code>key_cols</code>, <code>keep_map</code>,
and <code>prompt = FALSE</code>.</li>
<li>At either prompt, type <code>suggest</code> to reprint the recommended defaults.</li>
<li>You can type <code>all</code> to keep all rows for an ID, <code>none</code> to drop all rows,
or <code>q</code> to quit early.</li>
<li>If you quit early, all remaining duplicate groups are kept as-is.</li>
</ul>
<h2 id="sec:examples">Examples</h2>
<pre><code class="language-r">responses &lt;- GetResponses(form_id = &quot;123&quot;, api_key = &quot;abc&quot;)
flat &lt;- FlattenSubmissions(responses)

out &lt;- ReviewDuplicateSubmissions(flat, id_col = &quot;form_submissionid&quot;)
View(out$decisions)

# Non-interactive example (scriptable)
df &lt;- data.frame(
  submissionId = c(&quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;b&quot;, &quot;b&quot;),
  email = c(&quot;x@example.com&quot;, &quot;x@example.com&quot;, &quot;x@example.com&quot;, &quot;x@example.com&quot;, &quot;x@example.com&quot;),
  status = c(&quot;draft&quot;, &quot;final&quot;, &quot;test&quot;, &quot;final&quot;, &quot;final&quot;),
  stringsAsFactors = FALSE
)
# Group 1 will be the email=x@example.com group (the only group in this example)
keep_map &lt;- list(`1` = 2)
out2 &lt;- ReviewDuplicateSubmissions(
  df,
  id_col = &quot;submissionId&quot;,
  key_cols = &quot;email&quot;,
  compare_cols = c(&quot;submissionId&quot;, &quot;email&quot;, &quot;status&quot;),
  keep_map = keep_map,
  prompt = FALSE,
  quiet = TRUE
)
</code></pre>
<h2 id="sec:notes-and-tips">Notes and tips</h2>
<ul>
<li>Use this when you need human judgment (test submissions, edits, or data entry errors).</li>
<li>If you want an automatic rule-based approach, use <code>DeduplicateSubmissions()</code> instead.</li>
<li>Turn on audit logging if you need a clear record of the decisions.</li>
</ul>
<hr />
<p>Navigation</p>
<ul>
<li>Home: <a href="../index.html">Handbook Index</a></li>
<li>Function Index: <a href="index.html">All Functions</a></li>
<li>Prev: <a href="RenameCols.html">RenameCols</a></li>
<li>Next: <a href="ResolveRepeats.html">Next Function</a></li>
</ul>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</body>
</html>
